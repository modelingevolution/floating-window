@namespace ModelingEvolution.FloatingWindow

<div class="floating-window @(IsMinimized ? "minimized" : "")"
     style="@GetWindowStyle()"
     @ref="_windowElement">

    <MudPaper Elevation="8" Class="floating-window-paper">
        <div class="floating-window-header"
             @onmousedown="OnHeaderMouseDown"
             @onmousedown:stopPropagation="true">
            <MudText Typo="Typo.subtitle1" Class="floating-window-title">@Title</MudText>
            <MudSpacer />
            <MudIconButton Icon="@Icons.Material.Filled.Minimize"
                           Size="Size.Small"
                           OnClick="ToggleMinimize"
                           Class="floating-window-btn" />
            @if (CanMaximize)
            {
                <MudIconButton Icon="@(IsMaximized ? Icons.Material.Filled.FilterNone : Icons.Material.Filled.CropSquare)"
                               Size="Size.Small"
                               OnClick="ToggleMaximize"
                               Class="floating-window-btn" />
            }
            @if (CanClose)
            {
                <MudIconButton Icon="@Icons.Material.Filled.Close"
                               Size="Size.Small"
                               OnClick="Close"
                               Class="floating-window-btn" />
            }
        </div>

        @if (!IsMinimized)
        {
            <div class="floating-window-content">
                @ChildContent
            </div>

            @if (CanResize && !IsMaximized)
            {
                <div class="floating-window-resize-handle"
                     @onmousedown="OnResizeMouseDown"
                     @onmousedown:stopPropagation="true">
                </div>
            }
        }
    </MudPaper>
</div>

<style>
    .floating-window {
        position: fixed;
        z-index: 1300;
        user-select: none;
    }

    .floating-window.minimized {
        width: auto !important;
        height: auto !important;
    }

    .floating-window-paper {
        display: flex;
        flex-direction: column;
        height: 100%;
        overflow: hidden;
    }

    .floating-window-header {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        background: var(--mud-palette-primary);
        color: var(--mud-palette-primary-text);
        cursor: move;
        min-height: 40px;
    }

    .floating-window-title {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: inherit;
    }

    .floating-window-btn {
        color: inherit !important;
    }

    .floating-window-content {
        flex: 1;
        overflow: auto;
        padding: 16px;
    }

    .floating-window-resize-handle {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 16px;
        height: 16px;
        cursor: se-resize;
        background: linear-gradient(135deg, transparent 50%, var(--mud-palette-primary) 50%);
    }
</style>
