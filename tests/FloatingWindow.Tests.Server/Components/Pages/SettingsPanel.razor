<MudText Typo="Typo.h6" GutterBottom="true">Application Settings</MudText>

<MudTextField @bind-Value="_username"
              Label="Username"
              Variant="Variant.Outlined"
              Class="mb-4"
              data-testid="settings-username" />

<MudSwitch @bind-Value="_darkMode"
           Label="Dark Mode"
           Color="Color.Primary"
           Class="mb-4" />

<MudSelect T="string"
           @bind-Value="_language"
           Label="Language"
           Variant="Variant.Outlined"
           Class="mb-4">
    <MudSelectItem Value="@("en")">English</MudSelectItem>
    <MudSelectItem Value="@("pl")">Polish</MudSelectItem>
    <MudSelectItem Value="@("de")">German</MudSelectItem>
</MudSelect>

<div class="d-flex justify-end gap-2 mt-4">
    <MudButton Variant="Variant.Text"
               OnClick="Cancel"
               data-testid="settings-cancel">
        Cancel
    </MudButton>
    <MudButton Variant="Variant.Filled"
               Color="Color.Primary"
               OnClick="Save"
               data-testid="settings-save">
        Save
    </MudButton>
</div>

@code {
    [CascadingParameter]
    private IFloatingWindowInstance? Window { get; set; }

    private string _username = "User";
    private bool _darkMode = true;
    private string _language = "en";

    protected override void OnInitialized()
    {
        // Dynamically update the window title
        if (Window != null)
        {
            Window.Title = "Settings - " + _username;
        }
    }

    private async Task Cancel()
    {
        if (Window != null)
        {
            await Window.CloseAsync();
        }
    }

    private async Task Save()
    {
        if (Window != null)
        {
            await Window.CloseAsync($"Saved: {_username}, Dark={_darkMode}, Lang={_language}");
        }
    }
}
